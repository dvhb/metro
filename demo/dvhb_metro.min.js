angular.module("dvhbMetro",[]),function(t){"use strict";function e(e){function i(i,o,s){function n(){m.resolve(),t.forEach(f,function(t,e){d[t]=d[t]||{},d[t].isDisabled=i.stations?!r(i.stations,t):!0})}function r(e,i){return t.isArray(e)?-1!=e.indexOf(i):t.isObject(e)?t.isDefined(e[i]):!1}function l(){var t=$(o).find('[id^="s"]');t.each(function(){var t=$(this),e=t.find("circle:last"),i=t.find("text:last").text();t.attr("class","metro-station").attr("metro-station-name",i),e.attr("class",e.attr("class")+" metro-point")});var e=$(o).find('[id^="g"]');e.each(function(){var t=$(this);t.attr("class","metro-station").attr("metro-station-group","")})}function a(){e(o[0].querySelectorAll("svg"))(i)}var f,m=s.defer(),c=this,d={};i.metroInfo=null,l(),f=o[0].querySelectorAll("[metro-station-name]"),f=[].map.call(f,function(t){return t.attributes["metro-station-name"].nodeValue}),n(),c.setMetroInfo=function(t){i.metroInfo=t},c.onSelectStation=function(e,s){var n=o[0].getBoundingClientRect();s={left:s.left-n.left,top:s.top-n.top},(i.metroInfo&&i.metroInfo.show||t.noop)(s),(i.onSelect||t.noop)(e,s)},c.findStation=function(e){var i=d[e];return t.isDefined(i)?i:{}},i.$watch("stations",n,!0),a()}function o(e,i){var o="@import url('//fonts.googleapis.com/css?family=PT+Sans&subset=cyrillic');metro:after{content:\"\";display:block;padding-bottom:120%}metro svg{position:absolute;left:0;top:0;width:100%}.st0{fill:none;stroke:#D8AC9D;stroke-width:7.9994;stroke-miterlimit:10}.st1{fill:none;stroke:#B59E99;stroke-width:7.9994;stroke-miterlimit:10}.st2{fill:none;stroke:#D3D3D5;stroke-width:7.9994;stroke-miterlimit:10}.st3{fill:none;stroke:#CFE58F;stroke-width:7.9994;stroke-miterlimit:10}.st4{fill:none;stroke:#95D59F;stroke-width:7.9994;stroke-miterlimit:10}.st5{fill:none;stroke:#C28FCC;stroke-width:7.9994;stroke-miterlimit:10}.st6{fill:none;stroke:#FABE94;stroke-width:7.9994;stroke-miterlimit:10}.st7{fill:none;stroke:#F58C84;stroke-width:7.9994;stroke-miterlimit:10}.st8{fill:none;stroke:#FFDF80;stroke-width:7.9994;stroke-miterlimit:10}.st9{fill:none;stroke:#62BFF8;stroke-width:7.9994;stroke-miterlimit:10}.st10{fill:none;stroke:#8FE7FF;stroke-width:7.9994;stroke-miterlimit:10}.st11{fill:none;stroke:#ACBFE3;stroke-width:7.9994;stroke-miterlimit:10}.st12{fill:none;stroke:#9CE8E8;stroke-width:7.9994;stroke-miterlimit:10}.st13{fill:none;stroke:#B59E99;stroke-width:9;stroke-miterlimit:10}.st14{fill:none;stroke:#FFF;stroke-width:2.6;stroke-miterlimit:10}.st15{fill:none;stroke:#D3D3D5;stroke-width:9;stroke-miterlimit:10}.st16{fill:none;stroke:#62BFF8;stroke-width:9;stroke-miterlimit:10}.st17{fill:none;stroke:#C28FCC;stroke-width:9;stroke-miterlimit:10}.st18{fill:none;stroke:#95D59F;stroke-width:9;stroke-miterlimit:10}.st19{fill:none;stroke:#FABE94;stroke-width:9;stroke-miterlimit:10}.st20{fill:none;stroke:#F58C84;stroke-width:9;stroke-miterlimit:10}.st21{fill:none;stroke:#FFDF80;stroke-width:9;stroke-miterlimit:10}.st22{fill:none;stroke:#8FE7FF;stroke-width:9;stroke-miterlimit:10}.st23{fill:none;stroke:#D8AC9D;stroke-width:9;stroke-miterlimit:10}.st24{fill:none;stroke:#CFE58F;stroke-width:9;stroke-miterlimit:10}.st25{fill:none;stroke:#FFCB32;stroke-width:9;stroke-miterlimit:10}.st26{font-family:'PT Sans', sans-serif;}.st27{font-size:20px}.st28{fill:none;stroke:#C28FCC;stroke-width:8;stroke-miterlimit:10}.st29{fill:#8E479B}.st30{display:none;enable-background:new}.st31{fill:#C28FCC}.st32{fill:#FFF}.st33{fill:#FABE94}.st34{fill:#F58232}.st35{fill:none;stroke:#95D59F;stroke-width:8;stroke-miterlimit:10}.st36{fill:#4CB85E}.st37{fill:#95D59F}.st38{fill:#D8AC9D}.st39{fill:#9D573E}.st40{fill:#F58C84}.st41{fill:#ED3326}.st42{fill:#B59E99}.st43{fill:#7A655F}.st44{fill:#ACBFE3}.st45{fill:none;stroke:#ACBFE2;stroke-width:8;stroke-miterlimit:10}.st46{display:none;fill:#ACBFE3}.st47{fill:#8FE7FF}.st48{fill:#00BEF0}.st49{fill:none;stroke:#8FE7FF;stroke-width:8;stroke-miterlimit:10}.st50{fill:none;stroke:#62BFF8;stroke-width:8;stroke-miterlimit:10}.st51{fill:#0078BF}.st52{fill:#62BFF8}.st53{fill:#FFDF80}.st54{fill:#FFCB35}.st55{fill:none;stroke:#FFDF80;stroke-width:8;stroke-miterlimit:10}.st56{fill:#CFE58F}.st57{fill:#B4D445}.st58{fill:none;stroke:#CFE58F;stroke-width:8;stroke-miterlimit:10}.st59{fill:#D3D3D5}.st60{fill:#A0A2A3}.st61{fill:#9CE8E8}.st62{fill:#79CDCD}.st63{fill:none;stroke:#9CE8E8;stroke-width:8;stroke-miterlimit:10}.st64{fill:none;stroke:#D3D3D5;stroke-width:8;stroke-miterlimit:10}.st65{fill:none;stroke:#FABE94;stroke-width:8;stroke-miterlimit:10}.st66{fill:none;stroke:#F58C84;stroke-width:8;stroke-miterlimit:10}.st67{fill:none;stroke:#B59E99;stroke-width:8;stroke-miterlimit:10}g.metro-station{cursor:pointer}g.metro-station.disabled{cursor:initial}g.metro-station.selected text,g.metro-station.selected tspan{font-weight:700!important}g.metro-station.disabled text,g.metro-station.disabled tspan{fill:gray;cursor:initial}g.metro-station text.style1{font-family:'PT Sans','sans-serif';font-weight:400;font-style:normal;font-stretch:normal;font-variant:normal;font-size:20px}g.metro-station.disabled .metro-point{display:none}",s=document.createElement("style");s.id="dvhb_metro_styles",s.type="text/css",s.innerHTML=o,document.getElementsByTagName("head")[0].appendChild(s),i.on("click",function(i){i.originalEvent.data&&i.originalEvent.data.fromStation||(e.metroInfo&&e.metroInfo.hide||t.noop)()})}return i.$inject=["$scope","$element","$q"],{restrict:"AE",replace:!1,transclude:!0,controller:i,controllerAs:"metro",link:o,templateUrl:function(t,e){return e.mapUrl||"./metro.svg"},scope:{stations:"=?",onSelect:"=?"}}}t.module("dvhbMetro").directive("metro",e),e.$inject=["$compile"]}(angular),function(t){"use strict";function e(){function t(t,e,i,o){function s(){for(var t,i,o=e.find("circle"),s=o.length-1;s>=0;s--)if((" "+o[s].className.baseVal+" ").indexOf(" metro-point ")>-1){t=o[s],i=t.getBoundingClientRect();break}return i?{left:i.left,top:i.top}:null}function n(e){t.data.isDisabled||(e.originalEvent.data={fromStation:!0},a.onSelectStation([l],s())),!t.data.isDisabled&&a.multiple&&(t.data.isActive=!t.data.isActive)}function r(){l=i.metroStationName,e.bind("click",n);var o=a.findStation(l);o&&(t.data=o,f&&f.registerStation(l,o),t.$watch("data.isDisabled",function(t){var i=e[0],o=/disabled/.test(i.className.baseVal);!o&&t&&(i.className.baseVal=i.className.baseVal+" disabled"),o&&!t&&(i.className.baseVal=i.className.baseVal.split(" ").filter(function(t){return"disabled"!=t}).join(" "))}))}var l,a=o[1],f=o[0];r()}return{require:["?^metroStationGroup","^metro"],restrict:"A",link:t,scope:{}}}t.module("dvhbMetro").directive("metroStationName",e)}(angular),function(t){"use strict";function e(){function e(e,i,o,s){function n(e){return t.extend(e,m)}function r(t){var o=t.left,s=t.top;e.offset&&e.offset.left&&(o+=e.offset.left||0),e.offset&&e.offset.top&&(s+=e.offset.top||0),i.css("left",o+"px"),i.css("top",s+"px"),i.css("display","block")}function l(){i.css("display","none")}function a(){return"block"==i.css("display")}function f(){i.css("position","absolute"),l(),c.setMetroInfo(n({})),e.control&&n(e.control)}var m,c=s[0];m={show:r,hide:l,isOpen:a},f()}return{require:["^metro"],restrict:"A",link:e,scope:{control:"=?",offset:"=?"}}}t.module("dvhbMetro").directive("metroInfo",e)}(angular),function(t){"use strict";function e(){function e(t,e){t.stations={},t.main="",this.registerStation=function(e,i){t.stations[e]=i,t.main=e}}function i(e,i,o,s){function n(){var i=!0;return t.forEach(e.stations,function(t,e){t.isDisabled===!1&&(i=!1)}),i}e.$watch(n,function(t){var e=i[0],o=/disabled/.test(e.className.baseVal);!o&&t&&(e.className.baseVal=e.className.baseVal+" disabled"),o&&!t&&(e.className.baseVal=e.className.baseVal.split(" ").filter(function(t){return"disabled"!=t}).join(" "))}),i.find("text").bind("click",function(t){var i=[];if(!n()){for(var o in e.stations)o.isDisabled||i.push(o);t.originalEvent.data={fromStation:!0};var r=t.target.getBoundingClientRect();s.onSelectStation(i,r)}})}return e.$inject=["$scope","$element"],{restrict:"A",link:i,require:"^metro",controller:e,replace:!1,scope:{}}}t.module("dvhbMetro").directive("metroStationGroup",e)}(angular);