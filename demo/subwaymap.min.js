angular.module("dvhbSubwayMap",[]),function(t){"use strict";function n(){function n(n,i,o,e,a){function s(){u.resolve(),t.forEach(c,function(t,i){f[t]=f[t]||{},f[t].isDisabled=n.stations?!r(n.stations,t):!0})}function r(n,i){return t.isArray(n)?-1!=n.indexOf(i):t.isObject(n)?t.isDefined(n[i]):!1}var c,u,u=a.defer(),l=this,f={};n.subwayInfo=null,c=o[0].querySelectorAll("[subway-station-name]"),c=[].map.call(c,function(t){return t.attributes["subway-station-name"].nodeValue}),s(),l.setSubwayInfo=function(t){n.subwayInfo=t},l.onSelectStation=function(i,e){var a=o[0].getBoundingClientRect();e={left:e.left-a.left,top:e.top-a.top},(n.subwayInfo.show||t.noop)(e),(n.onSelect||t.noop)(i,e)},l.findStation=function(n){var i=f[n];return t.isDefined(i)?i:{}},n.$watch("stations",s,!0)}function i(n,i,o){i.css("position","relative"),i.on("click",function(i){i.originalEvent.data&&i.originalEvent.data.fromStation||(n.subwayInfo.hide||t.noop)()})}return n.$inject=["$scope","$http","$element","$attrs","$q"],{restrict:"AE",replace:!1,transclude:!0,controller:n,controllerAs:"subwayMap",link:i,templateUrl:function(t,n){return n.mapUrl||"./metro.svg"},scope:{stations:"=?",onSelect:"=?"}}}t.module("dvhbSubwayMap").directive("subwayMap",n)}(angular),function(t){"use strict";function n(){function t(t,n,i,o){function e(){for(var t,i,o=n.find("circle"),e=o.length-1;e>=0;e--)if(o[e].classList.contains("subway-point")){t=o[e],i=t.getBoundingClientRect();break}return i?{left:i.left,top:i.top+window.scrollY}:null}function a(n){t.data.isDisabled||(n.originalEvent.data={fromStation:!0},c.onSelectStation([r],e())),!t.data.isDisabled&&c.multiple&&(t.data.isActive=!t.data.isActive)}function s(){r=i.subwayStationName,n.bind("click",a);var o=c.findStation(r);o&&(t.data=o,u&&u.registerStation(r,o),t.$watch("data.isDisabled",function(t){n[0].classList.toggle("disabled",t)}))}var r,c=o[1],u=o[0];s()}return{require:["?^subwayStationGroup","^subwayMap"],restrict:"A",link:t,scope:{}}}t.module("dvhbSubwayMap").directive("subwayStationName",n)}(angular),function(t){"use strict";function n(){function n(n,i,o,e){function a(n){return t.extend(n,l)}function s(t){var o=t.left,e=t.top;n.offset&&n.offset.left&&(o+=n.offset.left||0),n.offset&&n.offset.top&&(e+=n.offset.top||0),i.css("left",o+"px"),i.css("top",e+"px"),i.css("display","block")}function r(){i.css("display","none")}function c(){return"block"==i.css("display")}function u(){i.css("position","absolute"),r(),f.setSubwayInfo(a({})),n.control&&a(n.control)}var l,f=e[0];l={show:s,hide:r,isOpen:c},u()}return{require:["^subwayMap"],restrict:"A",link:n,scope:{control:"=?",offset:"=?"}}}t.module("dvhbSubwayMap").directive("subwayInfo",n)}(angular),function(t){"use strict";function n(){function n(t,n){t.stations={},t.main="",this.registerStation=function(n,i){t.stations[n]=i,t.main=n}}function i(n,i,o,e){function a(){var i=!0;return t.forEach(n.stations,function(t,n){t.isDisabled===!1&&(i=!1)}),i}n.$watch(a,function(t){i[0].classList.toggle("disabled",t)}),i.find("text").bind("click",function(t){var i=[];if(!a()){for(var o in n.stations)o.isDisabled||i.push(o);t.originalEvent.data={fromStation:!0};var s=$(t.target).position();e.onSelectStation(i,s)}})}return n.$inject=["$scope","$element"],{restrict:"A",link:i,require:"^subwayMap",controller:n,replace:!1,scope:{}}}t.module("dvhbSubwayMap").directive("subwayStationGroup",n)}(angular);