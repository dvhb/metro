!function(t){"use strict";function i(){function i(i,n,e,a,o){function s(i){var n=d[i];return t.isDefined(n)?n:{}}function r(){u.resolve(),i.disabledStations=t.isDefined(i.disabledStations)?i.disabledStations:[],t.forEach(c,function(t){d[t]={isDisabled:i.stations?!i.stations[t]:!0}})}var c,u,u=o.defer(),l=this,d={};c=e[0].querySelectorAll("[subway-station-name]"),c=[].map.call(c,function(t){return t.attributes["subway-station-name"].nodeValue}),r(),l.onSelectStation=function(t,n){i.onSelect(t,n)},l.findStation=s}function n(t,i){i.css("position","relative")}return i.$inject=["$scope","$http","$element","$attrs","$q"],{restrict:"AE",replace:!1,transclude:!0,controller:i,controllerAs:"subwayMap",link:n,templateUrl:function(t,i){return i.mapUrl||"./metro.svg"},scope:{stations:"=?",onSelect:"=?"}}}function n(){function t(t,i,n,e){function a(){r=n.subwayStationName,i.bind("click",s);var e=c.findStation(r);e&&(t.data=e,u&&u.registerStation(r,e),t.$watch("data.isDisabled",function(t){i.toggleClass("disabled",t)}))}function o(){for(var t,n,e=i.find("circle"),a=e.length-1;a>=0;a--)if(e.eq(a).hasClass("subway-point")){t=e[a],n=t.getBoundingClientRect();break}return n?$(t).position():null}function s(){t.data.isDisabled||c.onSelectStation([r],o()),!t.data.isDisabled&&c.multiple&&(t.data.isActive=!t.data.isActive)}var r,c=e[1],u=e[0];a()}return{require:["?^subwayStationGroup","^subwayMap"],restrict:"A",link:t,scope:{}}}function e(){function i(t){t.stations={},t.main="",this.registerStation=function(i,n){t.stations[i]=n,t.main=i}}function n(i,n,e,a){function o(){var n=!0;return t.forEach(i.stations,function(t){t.isDisabled===!1&&(n=!1)}),n}i.$watch(o,function(t){n.toggleClass("disabled",t)}),n.find("text").bind("click",function(t){var n=[];if(!o()){for(var e in i.stations)e.isDisabled||n.push(e);var s=$(t.target).position();a.onSelectStation(n,s)}})}return i.$inject=["$scope","$element"],{restrict:"A",link:n,require:"^subwayMap",controller:i,replace:!1,scope:{}}}t.module("dvhbSubwayMap",[]),t.module("dvhbSubwayMap").directive("subwayMap",i),t.module("dvhbSubwayMap").directive("subwayStationName",n),t.module("dvhbSubwayMap").directive("subwayStationGroup",e)}(angular);