!function(t){"use strict";function n(){function n(n,i,e,a,o){function s(n){var i=f[n];return t.isDefined(i)?i:{}}function r(){l.resolve(),t.forEach(u,function(t){f[t]={isDisabled:n.stations?!c(n.stations,t):!0}})}function c(n,i){return t.isArray(n)?-1!=n.indexOf(i):t.isObject(n)?t.isDefined(n[i]):!1}var u,l,l=o.defer(),d=this,f={};u=e[0].querySelectorAll("[subway-station-name]"),u=[].map.call(u,function(t){return t.attributes["subway-station-name"].nodeValue}),r(),d.onSelectStation=function(t,i){n.onSelect(t,i)},d.findStation=s,n.$watchCollection("stations",r)}function i(t,n){n.css("position","relative")}return n.$inject=["$scope","$http","$element","$attrs","$q"],{restrict:"AE",replace:!1,transclude:!0,controller:n,controllerAs:"subwayMap",link:i,templateUrl:function(t,n){return n.mapUrl||"./metro.svg"},scope:{stations:"=?",onSelect:"=?"}}}function i(){function t(t,n,i,e){function a(){r=i.subwayStationName,n.bind("click",s);var e=c.findStation(r);e&&(t.data=e,u&&u.registerStation(r,e),t.$watch("data.isDisabled",function(t){n.toggleClass("disabled",t)}))}function o(){for(var t,i,e=n.find("circle"),a=e.length-1;a>=0;a--)if(e.eq(a).hasClass("subway-point")){t=e[a],i=t.getBoundingClientRect();break}return i?$(t).position():null}function s(){t.data.isDisabled||c.onSelectStation([r],o()),!t.data.isDisabled&&c.multiple&&(t.data.isActive=!t.data.isActive)}var r,c=e[1],u=e[0];a()}return{require:["?^subwayStationGroup","^subwayMap"],restrict:"A",link:t,scope:{}}}function e(){function n(t){t.stations={},t.main="",this.registerStation=function(n,i){t.stations[n]=i,t.main=n}}function i(n,i,e,a){function o(){var i=!0;return t.forEach(n.stations,function(t){t.isDisabled===!1&&(i=!1)}),i}n.$watch(o,function(t){i.toggleClass("disabled",t)}),i.find("text").bind("click",function(t){var i=[];if(!o()){for(var e in n.stations)e.isDisabled||i.push(e);var s=$(t.target).position();a.onSelectStation(i,s)}})}return n.$inject=["$scope","$element"],{restrict:"A",link:i,require:"^subwayMap",controller:n,replace:!1,scope:{}}}t.module("dvhbSubwayMap",[]),t.module("dvhbSubwayMap").directive("subwayMap",n),t.module("dvhbSubwayMap").directive("subwayStationName",i),t.module("dvhbSubwayMap").directive("subwayStationGroup",e)}(angular);